#!/usr/bin/env sh

OPTIONS_SPEC="\
git copy [options] <src> <dst>
git copy [options] <src>:<dst>...
--
v,verbose    enable verbose logging
"

# Parse options
eval "$(
    echo "$OPTIONS_SPEC" |
        git rev-parse --parseopt --keep-dashdash -- "$@" ||
        echo exit $?
)"

# Default values
src_dst_pairs=()
verbose=false

# Handle options and arguments
for opt in "$@"; do
    case "$opt" in
    --verbose | -v)
        verbose=true
        shift
        ;;
    --)
        shift
        break
        ;;
    -*)
        echo "Unknown option: $1"
        exit 1
        ;;
    *)
        break
        ;;
    esac
done

# Now process the <src>:<dst> pairs or <src> <dst> pairs
while [ "$#" -gt 0 ]; do
    if [[ "$1" == *:* ]]; then
        # Handle the <src>:<dst> format
        src_dst_pairs+=("$1")
        shift
    elif [ "$#" -gt 1 ]; then
        # Handle the <src> <dst> format
        src="$1"
        dst="$2"
        src_dst_pairs+=("$src:$dst")
        shift 2
    else
        echo "Invalid argument format: $1"
        exit 1
    fi
done

# Process the collected pairs
for pair in "${src_dst_pairs[@]}"; do
    src="${pair%%:*}"
    dst="${pair##*:}"
    echo "Processing source: $src, destination: $dst"
done

# process verbose flag
if $verbose; then
    echo "verbose processing enabled"
else
    echo "verbose processing disabled"
fi
